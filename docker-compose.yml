version: '3.3'

services:
    mbon_data_uploader:
        container_name: mbon_data_uploader
        build: ./mbon_data_uploader
        ports:
            - 5000:5000
        environment:
            - FLASK_APP=mbon_data_uploader  # TODO: this can be deleted?
            - POSTGIS_HOSTNAME=localhost:5432
            - POSTGRES_USER=postgis_user
            - POSTGRES_PASS=${POSTGRES_PASS}
            - POSTGRES_PORT=5432
            - POSTGRES_DB=worldview_images

    postgis:
        container_name: postgis
        image: kartoza/postgis:11.5-2.8
        environment:
            - POSTGRES_USER=postgis_user
            - POSTGRES_PASS=${POSTGRES_PASS}
            - ALLOW_IP_RANGE=0.0.0.0/0
            - POSTGRES_DB=worldview_images
            # - POSTGRES_MULTIPLE_EXTENSIONS=postgis,hstore,postgis_topology,postgis_raster,pgrouting
        ports:
            - "5432:5432"
        volumes:
            - ./postgis/data-dir:/var/lib/postgresql
            - ./postgis/docker-entrypoint-initdb.d/1_setup.sh:/docker-entrypoint-initdb.d/setup-db.sh
